[
  {
    "projectId": "db8ff920-d087-466a-97bc-8057202fa1ca",
    "testId": "2847ff06-4622-4b13-bd10-54fe13a05e13",
    "userId": "0488f4a8-f091-7062-f1c5-b0736c5e9633",
    "title": "TC003-AI proposal cards display correct module, subject images, ratios, and prompts",
    "description": "Check AI-generated proposal cards show module names, subject selections with thumbnails, recommended ratios, and final prompts correctly.",
    "code": "import asyncio\nfrom playwright import async_api\n\nasync def run_test():\n    pw = None\n    browser = None\n    context = None\n\n    try:\n        # Start a Playwright session in asynchronous mode\n        pw = await async_api.async_playwright().start()\n\n        # Launch a Chromium browser in headless mode with custom arguments\n        browser = await pw.chromium.launch(\n            headless=True,\n            args=[\n                \"--window-size=1280,720\",         # Set the browser window size\n                \"--disable-dev-shm-usage\",        # Avoid using /dev/shm which can cause issues in containers\n                \"--ipc=host\",                     # Use host-level IPC for better stability\n                \"--single-process\"                # Run the browser in a single process mode\n            ],\n        )\n\n        # Create a new browser context (like an incognito window)\n        context = await browser.new_context()\n        context.set_default_timeout(5000)\n\n        # Open a new page in the browser context\n        page = await context.new_page()\n\n        # Navigate to your target URL and wait until the network request is committed\n        await page.goto(\"http://localhost:5173\", wait_until=\"commit\", timeout=10000)\n\n        # Wait for the main page to reach DOMContentLoaded state (optional for stability)\n        try:\n            await page.wait_for_load_state(\"domcontentloaded\", timeout=3000)\n        except async_api.Error:\n            pass\n\n        # Iterate through all iframes and wait for them to load as well\n        for frame in page.frames:\n            try:\n                await frame.wait_for_load_state(\"domcontentloaded\", timeout=3000)\n            except async_api.Error:\n                pass\n\n        # Interact with the page elements to simulate user flow\n        # -> Navigate to http://localhost:5173\n        await page.goto(\"http://localhost:5173\", wait_until=\"commit\", timeout=10000)\n        \n        # -> Enter a multi-line request into the sidebar chat to trigger AI proposal cards, then send it.\n        frame = context.pages[-1]\n        # Input text\n        elem = frame.locator('xpath=html/body/div[1]/main/aside/div[4]/div[2]/textarea').nth(0)\n        await page.wait_for_timeout(3000); await elem.fill('这是一个测试需求：\n请为产品详情页生成3个创意方案，每个方案包含：\n- 模块名（例如：主图、场景图、细节图）\n- 主题选择（请在每个方案中返回缩略图索引或标识）\n- 推荐比例（例如 1:1、4:3、3:4）\n- 最终优化后的提示词（用于图像生成）\n\n参考图片将稍后上传。请以结构化卡片形式返回（模块名、主题缩略图索引、推荐比例、最终提示词）。\n谢谢。')\n        \n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[1]/main/aside/div[4]/div[2]/button[2]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        # -> Open API/provider settings to configure or re-enable the backend so the AI can generate proposal cards.\n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[1]/header/div/button[2]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        # -> Click the provider option (comfly测试) in the API settings to enable the backend so the AI can generate proposal cards (click element index 936).\n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[2]/div/div[2]/div/div[2]/div[1]/span').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        # -> Select the 'comfly测试' provider in API settings, save settings, then resend the same multi-line chat message in the sidebar to trigger AI proposal cards and observe results.\n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[2]/div/div[2]/div').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[2]/div/div[3]/button[2]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        frame = context.pages[-1]\n        # Input text\n        elem = frame.locator('xpath=html/body/div[1]/main/aside/div[4]/div[2]/textarea').nth(0)\n        await page.wait_for_timeout(3000); await elem.fill('这是一个测试需求：\n请为产品详情页生成3个创意方案，每个方案包含：\n- 模块名（例如：主图、场景图、细节图）\n- 主题选择（请在每个方案中返回缩略图索引或标识）\n- 推荐比例（例如 1:1、4:3、3:4）\n- 最终优化后的提示词（用于图像生成）\n\n参考图片将稍后上传。请以结构化卡片形式返回（模块名、主题缩略图索引、推荐比例、最终提示词）。\n谢谢。')\n        \n        # -> Send the re-typed multi-line chat message by clicking the send button so the backend can produce proposal cards, then inspect the results.\n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[1]/main/aside/div[4]/div[2]/button[2]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        # -> Open API provider settings and confirm 'comfly测试' is actually enabled (or change provider) so backend becomes available. Immediate action: open the API settings panel.\n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[1]/header/div/button[2]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        await asyncio.sleep(5)\n\n    finally:\n        if context:\n            await context.close()\n        if browser:\n            await browser.close()\n        if pw:\n            await pw.stop()\n\nasyncio.run(run_test())\n    ",
    "testStatus": "FAILED",
    "testError": "Result: Test cannot be completed because the AI backend is unavailable. Observations and actions taken:\n- The app displays repeated messages: '抱歉，服务暂时不可用。' whenever the chat request is sent.\n- Two attempts were made to send the required multi-line request; both returned the service-unavailable message.\n- API provider settings were opened and 'comfly测试' was selected and saved, but subsequent requests still returned the same error.\n- No AI-generated proposal cards were produced; therefore verification of module names, subject thumbnails/indices, recommended ratios, and final prompts could not be performed.\nRecommended next steps to resolve the blockage:\n1) Verify that an API provider is properly enabled and configured in the app (API key present, provider reachable). Open '配置 API 提供商' and confirm provider status and keys.\n2) Check network connectivity and any local backend/service processes that the frontend depends on. Ensure backend server is running and reachable from the frontend.\n3) Inspect browser console and server logs for errors (network failures, CORS, authentication). The app should log requests and failures—look for failed requests and error details.\n4) If provider requires credentials, enter valid API keys or switch to a known-working provider, then resend the multi-line chat.\n5) After backend becomes available, resend the test request and verify the four items: module names, thumbnail indices, recommended ratios, and final prompts. Also confirm the 'Confirm and Generate' flow and generation polling as needed.\nCurrent test status: FAILED to complete due to backend/service unavailability. No proposal cards to validate. Please fix the backend/provider configuration or provide access to a working provider, then re-run the test.\n",
    "testType": "FRONTEND",
    "createFrom": "mcp",
    "testVisualization": "https://testsprite-videos.s3.us-east-1.amazonaws.com/0488f4a8-f091-7062-f1c5-b0736c5e9633/1769583111834216//tmp/test_task/result.webm",
    "created": "2026-01-28T06:46:50.691Z",
    "modified": "2026-01-28T06:51:51.956Z"
  },
  {
    "projectId": "db8ff920-d087-466a-97bc-8057202fa1ca",
    "testId": "72147509-1d55-43f1-bfc5-4faff77771dc",
    "userId": "0488f4a8-f091-7062-f1c5-b0736c5e9633",
    "title": "TC004-Proposal card 'Sync Prompt' updates workspace prompt input",
    "description": "Verify that clicking 'Sync Prompt' on any proposal card updates the workspace prompt input field with the card's prompt text.",
    "code": "import asyncio\nfrom playwright import async_api\n\nasync def run_test():\n    pw = None\n    browser = None\n    context = None\n\n    try:\n        # Start a Playwright session in asynchronous mode\n        pw = await async_api.async_playwright().start()\n\n        # Launch a Chromium browser in headless mode with custom arguments\n        browser = await pw.chromium.launch(\n            headless=True,\n            args=[\n                \"--window-size=1280,720\",         # Set the browser window size\n                \"--disable-dev-shm-usage\",        # Avoid using /dev/shm which can cause issues in containers\n                \"--ipc=host\",                     # Use host-level IPC for better stability\n                \"--single-process\"                # Run the browser in a single process mode\n            ],\n        )\n\n        # Create a new browser context (like an incognito window)\n        context = await browser.new_context()\n        context.set_default_timeout(5000)\n\n        # Open a new page in the browser context\n        page = await context.new_page()\n\n        # Navigate to your target URL and wait until the network request is committed\n        await page.goto(\"http://localhost:5173\", wait_until=\"commit\", timeout=10000)\n\n        # Wait for the main page to reach DOMContentLoaded state (optional for stability)\n        try:\n            await page.wait_for_load_state(\"domcontentloaded\", timeout=3000)\n        except async_api.Error:\n            pass\n\n        # Iterate through all iframes and wait for them to load as well\n        for frame in page.frames:\n            try:\n                await frame.wait_for_load_state(\"domcontentloaded\", timeout=3000)\n            except async_api.Error:\n                pass\n\n        # Interact with the page elements to simulate user flow\n        # -> Navigate to http://localhost:5173\n        await page.goto(\"http://localhost:5173\", wait_until=\"commit\", timeout=10000)\n        \n        # -> Send a chat message to trigger generation of proposal cards (use the chat input) and press Send to load proposal cards.\n        frame = context.pages[-1]\n        # Input text\n        elem = frame.locator('xpath=html/body/div[1]/main/aside/div[4]/div[2]/textarea').nth(0)\n        await page.wait_for_timeout(3000); await elem.fill('请生成3条图像提示卡片，每条包含完整可直接用作生成的提示文本，用中文描述。')\n        \n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[1]/main/aside/div[4]/div[2]/button[2]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        await asyncio.sleep(5)\n\n    finally:\n        if context:\n            await context.close()\n        if browser:\n            await browser.close()\n        if pw:\n            await pw.stop()\n\nasyncio.run(run_test())\n    ",
    "testStatus": "FAILED",
    "testError": "Test stopped - failure to proceed: Proposal cards not present. Details:\n- Sent chat request (chat textarea index 156, send button index 158). App responded with error message: '抱歉，服务暂时不可用.'\n- No proposal cards or 'Sync Prompt' buttons found on the page to click.\n- Workspace prompt input exists at index 354 and appears empty; cannot verify synchronization because no card was available to sync.\nRecommendations to continue testing:\n1) Resolve backend/service availability (the error indicates the generation service is down) and re-run the chat generation step until proposal cards are produced.\n2) Once proposal cards appear, click any card's 'Sync Prompt' and then assert that prompt-input (index 354) value equals the card prompt text exactly.\nBecause the core prerequisite (proposal cards) is missing due to service error, the test cannot be completed now. Set success=false.",
    "testType": "FRONTEND",
    "createFrom": "mcp",
    "testVisualization": "https://testsprite-videos.s3.us-east-1.amazonaws.com/0488f4a8-f091-7062-f1c5-b0736c5e9633/1769582894934988//tmp/test_task/result.webm",
    "created": "2026-01-28T06:46:50.697Z",
    "modified": "2026-01-28T06:48:15.055Z"
  },
  {
    "projectId": "db8ff920-d087-466a-97bc-8057202fa1ca",
    "testId": "72b8a603-c22a-409f-a74d-74dae249e0fa",
    "userId": "0488f4a8-f091-7062-f1c5-b0736c5e9633",
    "title": "TC014-Backend task polling endpoint behavior and completion handling",
    "description": "Test backend task polling API correctly reports task status updates and signals completion for frontend to update preview.",
    "code": "import asyncio\nfrom playwright import async_api\n\nasync def run_test():\n    pw = None\n    browser = None\n    context = None\n\n    try:\n        # Start a Playwright session in asynchronous mode\n        pw = await async_api.async_playwright().start()\n\n        # Launch a Chromium browser in headless mode with custom arguments\n        browser = await pw.chromium.launch(\n            headless=True,\n            args=[\n                \"--window-size=1280,720\",         # Set the browser window size\n                \"--disable-dev-shm-usage\",        # Avoid using /dev/shm which can cause issues in containers\n                \"--ipc=host\",                     # Use host-level IPC for better stability\n                \"--single-process\"                # Run the browser in a single process mode\n            ],\n        )\n\n        # Create a new browser context (like an incognito window)\n        context = await browser.new_context()\n        context.set_default_timeout(5000)\n\n        # Open a new page in the browser context\n        page = await context.new_page()\n\n        # Navigate to your target URL and wait until the network request is committed\n        await page.goto(\"http://localhost:5173\", wait_until=\"commit\", timeout=10000)\n\n        # Wait for the main page to reach DOMContentLoaded state (optional for stability)\n        try:\n            await page.wait_for_load_state(\"domcontentloaded\", timeout=3000)\n        except async_api.Error:\n            pass\n\n        # Iterate through all iframes and wait for them to load as well\n        for frame in page.frames:\n            try:\n                await frame.wait_for_load_state(\"domcontentloaded\", timeout=3000)\n            except async_api.Error:\n                pass\n\n        # Interact with the page elements to simulate user flow\n        # -> Navigate to http://localhost:5173\n        await page.goto(\"http://localhost:5173\", wait_until=\"commit\", timeout=10000)\n        \n        # -> Fill the prompt input and click the '应用编辑' / Generate button to submit an image generation task.\n        frame = context.pages[-1]\n        # Input text\n        elem = frame.locator('xpath=html/body/div[1]/main/div[2]/div[1]/aside/div/div[5]/textarea').nth(0)\n        await page.wait_for_timeout(3000); await elem.fill('测试：验证后端任务轮询返回中间状态并最终生成图像以更新前端预览。请返回中间状态消息并最终的图像数据。')\n        \n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[1]/main/div[2]/div[1]/aside/div/button[1]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        # -> Open API provider settings in the UI to inspect provider configuration details (may reveal base URL/paths or additional info useful for polling). Then extract any visible endpoint or test buttons.\n        frame = context.pages[-1]\n        # Click element\n        elem = frame.locator('xpath=html/body/div[1]/header/div/button[2]').nth(0)\n        await page.wait_for_timeout(3000); await elem.click(timeout=5000)\n        \n        # --> Assertions to verify final state\n        frame = context.pages[-1]\n        try:\n            await expect(frame.locator('text=Image generation complete').first).to_be_visible(timeout=3000)\n        except AssertionError:\n            raise AssertionError(\"Test case failed: expected backend task polling to complete and the frontend preview to update with the generated image (indicator 'Image generation complete'), but the success indicator never appeared — polling or preview update likely failed\")\n        await asyncio.sleep(5)\n\n    finally:\n        if context:\n            await context.close()\n        if browser:\n            await browser.close()\n        if pw:\n            await pw.stop()\n\nasyncio.run(run_test())\n    ",
    "testStatus": "FAILED",
    "testError": "Test run stopped. Summary of findings:\n\n- Navigation: reached http://localhost:5173 and UI is interactive.\n- Generation submission: prompt filled and '应用编辑' clicked successfully. The app logged '开始生成任务', but multiple alerts and worklog entries show '生成失败: Failed to fetch'.\n- Backend access: network/backend appears unreachable from the frontend (multiple 'Failed to fetch' errors). External script /script.js could not be fetched (TypeError: Failed to fetch), preventing inspection of client polling logic and extraction of task IDs or endpoints.\n- Local configuration: localStorage contains an API provider entry with url: https://ai.comfly.chat/v1 (provider id default-1769582832223). This may be the intended backend base URL.\n- Polling and verification: unable to start or verify polling because no task id or polling endpoint could be determined and backend requests fail. Therefore the assertions could not be completed:\n  * Verify polling returns in-progress messages - NOT VERIFIED\n  * Confirm final polling response contains generated image data/status - NOT VERIFIED\n  * Check frontend preview updates after final poll - NOT VERIFIED\n\nRecommended next steps to allow the test to complete:\n1) Ensure the backend/API (https://ai.comfly.chat/v1 or local server) is reachable from the browser (fix network/CORS or start the backend). 2) Re-run the test. If issues persist, provide backend logs or allow access to script.js so the polling logic and endpoints can be inspected. 3) If desired, the next automated action can be: (a) attempt one more fetch of /script.js (final allowed attempt), or (b) directly call known provider endpoints (if permitted) to query task status.\n\nBecause the backend was not reachable, the test cannot be completed now. Stopping as requested.",
    "testType": "FRONTEND",
    "createFrom": "mcp",
    "testVisualization": "https://testsprite-videos.s3.us-east-1.amazonaws.com/0488f4a8-f091-7062-f1c5-b0736c5e9633/1769583301719432//tmp/test_task/result.webm",
    "created": "2026-01-28T06:46:50.706Z",
    "modified": "2026-01-28T06:55:01.932Z"
  }
]
